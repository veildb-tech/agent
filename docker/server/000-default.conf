ServerName ${SERVER_URL}

<VirtualHost *:80>
    ServerName ${SERVER_URL}

    DocumentRoot /app/public
    <Directory /app/public>
        AllowOverride All
        Require all granted

        FallbackResource /index.php
    </Directory>

    <Directory /app/bundles>
        FallbackResource disabled
    </Directory>

      <If "'${APP_ENV}' == 'prod'">
        RewriteEngine On
        RewriteCond %{HTTPS} off
        RewriteRule ^(.*)$ https://%{SERVER_NAME}:${HTTPS_PORT}%{REQUEST_URI} [L,R=301]
      </If>

    ErrorLog /app/var/server/error.log
    CustomLog /app/var/server/access.log combined
</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerName ${SERVER_URL}

        SSLEngine on
        SSLCertificateFile /etc/apache2/certs/ssl.crt
        SSLCertificateKeyFile /etc/apache2/certs/ssl.key

        #SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire
        <FilesMatch "\.(cgi|shtml|phtml|php)$">
            SSLOptions +StdEnvVars
        </FilesMatch>
        <Directory /usr/lib/cgi-bin>
            SSLOptions +StdEnvVars
        </Directory>

        DocumentRoot /app/public
        <Directory /app/public>
            AllowOverride All
            Require all granted

            FallbackResource /index.php
        </Directory>

        <Directory /app/bundles>
            FallbackResource disabled
        </Directory>

        ErrorLog /app/var/server/error.log
        CustomLog /app/var/server/access.log combined
    </VirtualHost>
</IfModule>